#!/usr/bin/env python

import sys, os
import getopt

# Local imports
from defs import *
from PageRange import *

if __name__ == "__main__":
    # Configuration
    config = {
        'overlap': 5, # mm
        'page_size': (210, 297), # A4
        'page_border': 10, # mm
        'map_file': "foo.mapnik",
        'output': "map.pdf",
        'ranges': [{
            'bounds': (15.4410,47.072,15.4451,47.0664),
            'scale': 2000
        },
        {
            'bounds': (15.4,47.0,15.5,47.1),
            'scale': 100000
        }]
    }

    # Load Page Ranges
    page_ranges = []
    sum_pages = 0
    for range in config['ranges']:
        for k, v in config.iteritems():
            if not k in range:
                range[k] = v;

        range['page_number_offset'] = sum_pages

        current = PageRange(range)
        page_ranges.append(current)

        sum_pages += current.count_pages()
        print sum_pages

    # Produce final PDF
    final_pdf = PDF.PdfFileWriter()
    for range in page_ranges:
        range.render(final_pdf)

    final_pdf.write(file(config['output'], 'wb'))
